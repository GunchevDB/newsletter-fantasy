<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simple Newsletter Builder</title>
  <link rel="stylesheet" href="/styles.css" />
</head>

<body>
  <header class="top-nav">
    <div class="brand">
      <button id="mobile-nav-toggle" class="nav-toggle" type="button" aria-label="Toggle navigation"
        aria-controls="primary-nav" aria-expanded="false">
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
      </button>
      <div class="brand-text">
        <h1>Simple Newsletter Builder</h1>
        <p>Craft engaging updates, manage subscribers, and deliver confidently.</p>
      </div>
    </div>
    <nav id="primary-nav" class="nav-tabs" role="tablist" aria-label="Primary navigation">
      <button class="nav-tab is-active" type="button" role="tab" aria-selected="true" data-target="compose-view"
        id="compose-tab">
        <span class="icon" aria-hidden="true">✏️</span>
        <span>Compose</span>
      </button>
      <button class="nav-tab" type="button" role="tab" aria-selected="false" data-target="subscribers-view"
        id="subscribers-tab">
        <span class="icon" aria-hidden="true">👥</span>
        <span>Subscribers</span>
      </button>
      <button class="nav-tab" type="button" role="tab" aria-selected="false" data-target="analytics-view"
        id="analytics-tab">
        <span class="icon" aria-hidden="true">📊</span>
        <span>Analytics</span>
      </button>
    </nav>
    <div class="nav-actions">
      <button id="logout-button" class="btn ghost icon-left" type="button">
        <span class="icon" aria-hidden="true">🚪</span>
        <span>Logout</span>
      </button>
    </div>
  </header>

  <main class="app-shell">
    <section id="compose-view" class="view-card is-active" data-view="compose-view" role="tabpanel"
      aria-labelledby="compose-tab">
      <article class="card compose-card">
        <header class="card-header">
          <div>
            <h2>Compose Newsletter</h2>
            <p>Plan your subject line, teaser, and full content in one focused workspace.</p>
          </div>
        </header>
        <div class="card-body">

          <!-- Best Practices Checklist -->
          <div class="best-practices-checklist">
            <div class="checklist-header">
              <h3>✓ Best Practices</h3>
              <button id="toggle-checklist" class="btn-text" type="button">Hide</button>
            </div>
            <div id="checklist-items" class="checklist-items">
              <div class="checklist-item" id="check-title">
                <span class="check-icon">○</span>
                <span class="check-label">Subject line filled (&lt; 50 chars)</span>
              </div>
              <div class="checklist-item" id="check-preview">
                <span class="check-icon">○</span>
                <span class="check-label">Preview text added (40-130 chars)</span>
              </div>
              <div class="checklist-item" id="check-image">
                <span class="check-icon">○</span>
                <span class="check-label">At least one image included</span>
              </div>
              <div class="checklist-item" id="check-length">
                <span class="check-icon">○</span>
                <span class="check-label">Content length reasonable (&lt; 1000 words)</span>
              </div>
              <div class="checklist-item" id="check-cta">
                <span class="check-icon">○</span>
                <span class="check-label">Has a clear call-to-action</span>
              </div>
            </div>
          </div>

          <div class="template-action-bar">
            <div class="template-dropdown">
              <button id="template-menu-button" class="btn secondary icon-left" type="button" aria-haspopup="true"
                aria-expanded="false">
                <span class="icon" aria-hidden="true">📂</span>
                <span>Load template</span>
                <span class="dropdown-caret" aria-hidden="true">▾</span>
              </button>
              <div id="template-menu" class="template-menu hidden" role="menu" aria-label="Saved templates"></div>
            </div>
          </div>

          <!-- Title field with character counter -->
          <div class="field">
            <div class="field-label-row">
              <label class="field-label" for="newsletter-title">Title</label>
              <span id="title-char-counter" class="char-counter">0 / 50</span>
            </div>
            <input id="newsletter-title" type="text" placeholder="Announcing our latest updates" aria-required="true"
              maxlength="100" />
          </div>

          <!-- Preview text with character counter -->
          <div class="field">
            <div class="field-label-row">
              <label class="field-label" for="newsletter-preview-text">Preview text</label>
              <span class="field-hint">Optional · Shown in inbox snippets</span>
            </div>
            <div class="input-with-counter">
              <input id="newsletter-preview-text" type="text" placeholder="A quick summary to entice opens"
                maxlength="150" aria-describedby="preview-char-counter" />
              <span id="preview-char-counter" class="char-counter">0 / 150</span>
            </div>
          </div>

          <!-- Spam Word Warnings -->
          <div id="spam-warning" class="spam-warning hidden">
            <span class="warning-icon">⚠️</span>
            <div class="warning-content">
              <strong>Spam trigger words detected:</strong>
              <span id="spam-words-list"></span>
              <p class="warning-hint">These words may trigger spam filters. Consider rephrasing.</p>
            </div>
          </div>

          <!-- Editor card with word count -->
          <div class="editor-card">
            <div class="editor-toolbar" role="toolbar" aria-label="Formatting options">
              <button class="btn ghost" data-command="bold" type="button">
                <span class="icon" aria-hidden="true">B</span>
                <span class="sr-only">Bold</span>
              </button>
              <button class="btn ghost" data-command="italic" type="button">
                <span class="icon" aria-hidden="true">I</span>
                <span class="sr-only">Italic</span>
              </button>
              <button class="btn ghost" data-command="createLink" type="button">
                <span class="icon" aria-hidden="true">🔗</span>
                <span class="sr-only">Insert link</span>
              </button>
              <button class="btn ghost" data-command="insertUnorderedList" type="button">
                <span class="icon" aria-hidden="true">•</span>
                <span class="sr-only">Bullet list</span>
              </button>
              <button id="upload-image-trigger" class="btn secondary icon-left" type="button">
                <span class="icon" aria-hidden="true">🖼️</span>
                <span>Insert image</span>
              </button>
              <input id="image-upload-input" type="file" accept="image/*" hidden />
              <div class="toolbar-spacer"></div>
              <span id="word-count" class="word-count">0 words</span>
            </div>
            <div id="newsletter-content" class="editor" contenteditable="true" aria-label="Newsletter content editor">
            </div>
            <p id="image-upload-status" class="status-inline" role="status" aria-live="polite"></p>
          </div>
        </div>
        <footer class="card-footer compose-actions">
          <div class="action-buttons">
            <button id="preview-button" class="btn secondary icon-left" type="button">
              <span class="icon" aria-hidden="true">👁️</span>
              <span>Preview email</span>
            </button>
            <button id="test-email-button" class="btn secondary icon-left" type="button">
              <span class="icon" aria-hidden="true">✉️</span>
              <span>Send test email</span>
            </button>
            <button id="send-button" class="btn primary icon-left" type="button">
              <span class="icon" aria-hidden="true">📧</span>
              <span id="send-button-label">Send newsletter</span>
            </button>
            <button id="save-draft-button" class="btn ghost icon-left" type="button">
              <span class="icon" aria-hidden="true">💾</span>
              <span>Save draft</span>
            </button>
            <button id="save-template-button" class="btn ghost icon-left" type="button">
              <span class="icon" aria-hidden="true">📌</span>
              <span>Save as template</span>
            </button>
            <button id="clear-draft-button" class="btn ghost icon-left" type="button">
              <span class="icon" aria-hidden="true">🗑️</span>
              <span>Clear draft</span>
            </button>
          </div>
          <p class="shortcut-hint" aria-live="polite">Shortcuts: Ctrl/Cmd&nbsp;+&nbsp;S to save · Ctrl/Cmd&nbsp;+&nbsp;Enter to preview</p>
          <p id="send-status" class="status-message" role="status" aria-live="polite"></p>
        </footer>
      </article>
    </section>

    <section id="subscribers-view" class="view-card" data-view="subscribers-view" role="tabpanel"
      aria-labelledby="subscribers-tab">
      <article class="card">
        <header class="card-header subscribers-header">
          <div>
            <h2>Subscribers</h2>
            <p>Search, filter, and manage everyone who receives your newsletter.</p>
          </div>
          <div class="subscribers-meta">
            <span class="badge" id="subscriber-total">0</span>
            <span class="badge-label">total subscribers</span>
            <span class="storage-pill storage-pill--warning" id="subscriber-storage-mode">
              Storage: --
            </span>
            <button id="toggle-add-subscriber" class="btn primary icon-left" type="button">
              <span class="icon" aria-hidden="true">➕</span>
              <span>Add subscriber</span>
            </button>
          </div>
        </header>
        <div class="card-body">
          <div class="subscriber-controls">
            <label class="search-field">
              <span class="sr-only">Search subscribers</span>
              <input id="subscriber-search" type="search" placeholder="Search by name or email" autocomplete="off" />
              <span class="icon" aria-hidden="true">🔍</span>
            </label>
            <label class="filter-field">
              <span class="field-label">Filter</span>
              <select id="subscriber-filter">
                <option value="all">All subscribers</option>
                <option value="recent-7">Joined in last 7 days</option>
                <option value="recent-30">Joined in last 30 days</option>
                <option value="source-manual">Source: Manual</option>
                <option value="source-public-api">Source: Public API</option>
                <option value="source-other">Source: Other</option>
              </select>
            </label>
          </div>

          <form id="add-subscriber-form" class="add-subscriber-form hidden">
            <div class="form-grid">
              <label class="field">
                <span class="field-label" for="subscriber-email">Email address</span>
                <input id="subscriber-email" type="email" placeholder="subscriber@example.com" autocomplete="email"
                  required />
              </label>
              <label class="field">
                <span class="field-label" for="subscriber-name">Name</span>
                <input id="subscriber-name" type="text" placeholder="Optional name" autocomplete="name" />
              </label>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn primary icon-left">
                <span class="icon" aria-hidden="true">✔️</span>
                <span>Add subscriber</span>
              </button>
              <button type="button" class="btn ghost" id="cancel-add-subscriber">
                Cancel
              </button>
            </div>
          </form>

          <div id="subscriber-loading" class="loading-indicator hidden" role="status" aria-live="polite">
            <span class="spinner" aria-hidden="true"></span>
            Loading subscribers...
          </div>

          <div class="table-responsive">
            <table class="subscribers-table">
              <thead>
                <tr>
                  <th scope="col">Email</th>
                  <th scope="col">Name</th>
                  <th scope="col">Subscribed</th>
                  <th scope="col">Source</th>
                  <th scope="col" class="align-right">Actions</th>
                </tr>
              </thead>
              <tbody id="subscriber-table-body"></tbody>
            </table>
          </div>

          <p id="subscribers-empty" class="empty-state" hidden>
            No subscribers match your filters yet.
          </p>

          <div class="pagination" id="subscriber-pagination">
            <button id="subscriber-prev" class="btn ghost" type="button">Previous</button>
            <span id="subscriber-page-info">Page 0 of 0</span>
            <button id="subscriber-next" class="btn ghost" type="button">Next</button>
          </div>

          <p id="subscriber-status" class="status-message" role="status" aria-live="polite"></p>
        </div>
      </article>
    </section>

    <!-- Analytics dashboard content -->
    <section id="analytics-view" class="view-card" data-view="analytics-view" role="tabpanel"
      aria-labelledby="analytics-tab">
      <article class="card analytics-card">
        <header class="card-header analytics-header">
          <div>
            <h2>Analytics Overview</h2>
            <p>Monitor how your newsletters are performing at a glance.</p>
          </div>
          <div class="analytics-actions">
            <button id="refresh-analytics" class="btn ghost" type="button">Refresh</button>
          </div>
        </header>
        <div class="card-body analytics-body">
          <div id="analytics-loading" class="analytics-loading" role="status" aria-live="polite">
            <span class="spinner" aria-hidden="true"></span>
            Loading analytics&hellip;
          </div>
          <p id="analytics-error" class="analytics-error hidden" role="alert"></p>
          <div id="analytics-content" class="analytics-content hidden">
            <div class="analytics-metrics">
              <div class="metric-card">
                <p class="metric-label">Total Subscribers</p>
                <p class="metric-value" id="analytics-total-subscribers">0</p>
              </div>
              <div class="metric-card">
                <p class="metric-label">Total Sent</p>
                <p class="metric-value" id="analytics-total-sent">0</p>
              </div>
              <div class="metric-card">
                <p class="metric-label">Last Campaign</p>
                <p class="metric-value" id="analytics-last-campaign">--</p>
                <p class="metric-subtext" id="analytics-last-campaign-status">No campaigns yet</p>
              </div>
            </div>

            <section class="analytics-panel">
              <header class="analytics-panel-header">
                <div>
                  <h3>Recent Campaigns</h3>
                  <p class="panel-subtext">Delivery performance for your latest sends</p>
                </div>
              </header>
              <div class="table-responsive">
                <table class="analytics-table">
                  <thead>
                    <tr>
                      <th scope="col">Title</th>
                      <th scope="col">Date</th>
                      <th scope="col">Recipients</th>
                      <th scope="col">Status</th>
                    </tr>
                  </thead>
                  <tbody id="analytics-campaigns-body">
                    <tr id="analytics-campaigns-empty">
                      <td colspan="4" class="muted">Send a newsletter to populate campaign history.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </section>

            <section class="analytics-panel">
              <header class="analytics-panel-header">
                <div>
                  <h3>Subscriber Growth</h3>
                  <p class="panel-subtext">Daily list size for the last 30 days</p>
                </div>
              </header>
              <div class="chart-wrapper">
                <canvas id="analytics-growth-chart" aria-label="Subscriber growth chart"></canvas>
              </div>
            </section>
          </div>
        </div>
      </article>
    </section>
  </main>

  <div id="preview-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="preview-modal-title">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-dialog">
      <header class="modal-header">
        <h2 id="preview-modal-title">Email Preview</h2>
        <button id="preview-close" class="btn icon-only" type="button" aria-label="Close preview">
          ✕
        </button>
      </header>
      <div class="modal-body">
        <iframe id="email-preview" class="preview-frame" title="Email preview" sandbox="allow-same-origin"></iframe>
      </div>
    </div>
  </div>

  <template id="subscriber-row-template">
    <tr>
      <td class="subscriber-email-cell">
        <span class="subscriber-email"></span>
      </td>
      <td class="subscriber-name-cell">
        <span class="subscriber-name muted"></span>
      </td>
      <td class="subscriber-date"></td>
      <td class="subscriber-source"></td>
      <td class="subscriber-actions align-right">
        <button class="btn danger icon-left remove-subscriber" type="button">
          <span class="icon" aria-hidden="true">🗑️</span>
          <span>Remove</span>
        </button>
      </td>
    </tr>
  </template>

  <div id="send-confirm-modal" class="modal hidden" role="dialog" aria-modal="true"
    aria-labelledby="send-confirm-title" aria-describedby="send-confirm-message">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-dialog">
      <header class="modal-header">
        <h2 id="send-confirm-title">Confirm Send</h2>
        <button id="send-confirm-close" class="btn icon-only" type="button" aria-label="Close confirmation">
          ✕
        </button>
      </header>
      <div class="modal-body confirm-modal-body">
        <p id="send-confirm-message">
          You're about to send to <strong><span id="send-confirm-count">0</span> subscribers</strong>. This cannot be
          undone. Continue?
        </p>
      </div>
      <footer class="modal-footer">
        <button id="send-confirm-cancel" class="btn ghost" type="button">Cancel</button>
        <button id="send-confirm-button" class="btn primary icon-left" type="button">
          <span class="icon" aria-hidden="true">📧</span>
          <span id="send-confirm-button-label">Send newsletter</span>
        </button>
      </footer>
    </div>
  </div>

  <div id="template-manage-modal" class="modal hidden" role="dialog" aria-modal="true"
    aria-labelledby="template-manage-title" aria-describedby="template-manage-description">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-dialog">
      <header class="modal-header">
        <h2 id="template-manage-title">Template Library</h2>
        <button id="template-manage-close" class="btn icon-only" type="button" aria-label="Close template manager">
          ✕
        </button>
      </header>
      <div class="modal-body manage-modal-body">
        <p id="template-manage-description" class="modal-subtitle">
          Load a saved layout or remove templates you no longer need.
        </p>
        <div id="template-manage-list" class="template-manage-list" role="list"></div>
        <p id="template-empty-state" class="template-empty-state hidden">No saved templates yet. Save one from the
          composer to reuse it later.</p>
      </div>
      <footer class="modal-footer">
        <button id="template-manage-close-footer" class="btn ghost" type="button">Close</button>
      </footer>
    </div>
  </div>

  <div id="template-save-modal" class="modal hidden" role="dialog" aria-modal="true"
    aria-labelledby="template-save-title">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-dialog">
      <header class="modal-header">
        <h2 id="template-save-title">Save as Template</h2>
        <button id="template-save-close" class="btn icon-only" type="button" aria-label="Close save template dialog">
          ✕
        </button>
      </header>
      <div class="modal-body save-modal-body">
        <label class="field">
          <span class="field-label" for="template-name-input">Template name</span>
          <input id="template-name-input" type="text" placeholder="e.g. Spring Product Launch" autocomplete="off"
            maxlength="80" />
        </label>
        <p class="modal-hint">Templates save the current title, preview text, and content in your browser.</p>
      </div>
      <footer class="modal-footer">
        <button id="template-save-cancel" class="btn ghost" type="button">Cancel</button>
        <button id="template-save-confirm" class="btn primary" type="button">Save template</button>
      </footer>
    </div>
  </div>

  <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js" defer></script>
  <script src="/app.js" defer></script>
</body>

</html>
